# 幅員構成のチェック

![](../images/WC/WC.svg)

照査概要
=
計画された幅員構成要素が過不足がないか照査する。

画面表示仕様
-
### 表示概要
幅員構成要素の照査タブに線形(Alignment)ごとに諸条件の設定タブを表示する。  

### 諸条件の設定
##### 基本情報の取得(LandXML)
Alignment配下の要素から取得する。

|項目名|XPath|型|
|--|--|--|
|規格|`../Feature/Property[@label='classification']`|string|
|等級|`../Feature/Property[@label='classification']`|string|
|設計速度|`LandXML/Roadways/Roadway[@alignmentRefs='{線形名}']/Speeds/DesignSpeed[@speed]`|string|
|直線部の横断勾配|`./Feature/Property[@label='normalCrown']`|string|
|測点間隔|`./Feature[@name='Interval']/Property[@label='main']`|int|

##### 条件値の入力(ユーザ入力)
全てのユーザ入力項目は照査に必須である。

|項目名|型|
|--|--|
|計画交通量|int|
|大型車混入率|decimal|
|自転車ネットワークの有無|bool|
|第3種第1級の道路に接続する第4種第1級の道路|bool|
|主要道路に該当する第3種第2級または第4種第1級の道路|bool|
|普通道路／小型道路の別|RoadSideStandard|
|暫定計画の有無|bool|
|自転車交通量|bool|
|歩行者交通量|bool|
|路上施設の種類|StreetSideFacilitiesType|
|道路の属する地域の地形|Topography|
|交差点の多い第4種道路|bool|

##### 照査結果
照査結果の表示形式は以下の通りである。

ヘッダーは2段組で表現される。

| | | |
|--|--|--|
|横断線形|||
|照査項目|判定|コメント|
|車線数|判定|コメント|
|中央帯および中央帯側帯|判定|コメント|
|路肩|判定|コメント|
|路肩側帯|判定|コメント|
|停車帯|判定|コメント|
|歩行者・自転車通行空間|判定|コメント|
|植樹帯|判定|コメント|

本照査で使用するメッセージは以下の通りである。

|照査項目|判定|メッセージID|概要|
|--|--|--|--|
|路肩|NG|W-0015|停車帯または自転車専用通行帯があるが、路肩が設置されている|
|路肩|NG|W-0014|停車帯または自転車専用通行帯があるが、路肩が設置されている。中央帯を設けない分離道路であるが右側路肩が設置されていない|
|路肩|OK|I-0009|右側路肩のみの設置|
|路肩|NG|W-0013|中央帯を設けない分離道路であるため右側路肩が必要|
|路肩|NG|W-0017|停車帯または自転車専用通行帯があるが、路肩が設置されている。中央帯を設けない分離道路でないが右側路肩が設置されている|
|路肩|NG|W-0018|停車帯または自転車専用通行帯があるが、路肩が設置されている|
|路肩|NG|W-0016|中央帯を設けない分離道路でないが右側路肩が設置されている|
|路肩|OK|I-0010|路肩を設置しない道路である|
|路肩|OK|I-0007|路肩、右側路肩ともに設置されている|
|路肩|NG|W-0009|中央帯を設けない分離道路であるが右側路肩が設置されていない|
|路肩|NG|W-0008|停車帯または自転車専用通行帯がないが、路肩が設置されていない|
|路肩|NG|W-0007|停車帯または自転車専用通行帯がないが、路肩が設置されていない。中央帯を設けない分離道路であるが右側路肩が設置されていない|
|路肩|NG|W-0012|中央帯を設けない分離道路でないが右側路肩が設置されている|
|路肩|OK|I-0008|路肩を設置する道路である|
|路肩|NG|W-0011|停車帯または自転車専用通行帯がないが、路肩が設置されていない。中央帯を設けない分離道路でないが右側路肩が設置されている|
|路肩|NG|W-0010|停車帯または自転車専用通行帯がないが、路肩が設置されていない|
|車線数|OK|I-0006|適切な車線数である|
|車線数|OK_C|W-0006|不適切な車線数である|
|中央帯および中央帯側帯|OK|I-0011|必ず中央帯および中央帯側帯を設置すべきで、適切に設置されている|
|中央帯および中央帯側帯|NG|W-0019|必ず中央帯および中央帯側帯を設置すべきであるが、設置されていない|
|中央帯および中央帯側帯|OK|I-0012|中央帯および中央帯側帯の設置が望ましく、適切に設置されている|
|中央帯および中央帯側帯|OK_C|I-0013|中央帯および中央帯側帯の設置が望ましいが、設置されていない|
|中央帯および中央帯側帯|OK_C|I-0015|中央帯および中央帯側帯を設置しなくてもよいが、設置されている|
|中央帯および中央帯側帯|OK|I-0014|中央帯および中央帯側帯を設置してよく、設置されていない|
|植樹帯|OK|I-0016|植樹帯の設置が望ましく、適切に設置されている|
|植樹帯|OK_C|I-0016|植樹帯の設置が望ましいが、設置されていない|
|植樹帯|OK_C|I-0019|植樹帯の設置は不要であるが、設置されている|
|植樹帯|OK|I-0018|植樹帯の設置は不要で、設置されていない|
|停車帯|OK|I-0018|第4種道路であり、停車帯が設置されている|
|停車帯|OK_C|I-0018|第4種道路であるが、停車帯が設置されていない|
|停車帯|NG|W-0020|第4種道路でないが、停車帯が設置されている|
|停車帯|OK|I-0022|第4種道路でなく、停車帯が設置されていない|
|路肩側帯|OK|I-0091|第1種道路または第2種道路であり、路肩側帯が設置されている|
|路肩側帯|NG|W-0062|第1種道路または第2種道路であるが、路肩側帯が設置されていない|
|路肩側帯|NG|W-0061|第1種道路または第2種道路でないが、路肩側帯が設置されている|
|路肩側帯|OK|I-0090|第1種道路または第2種道路でなく、路肩側帯が設置されていない|
|歩行者・自転車通行帯空間|OK|I-0023|適切な歩行者・自転車通行空間が設置されている|
|歩行者・自転車通行帯空間|OK_C|I-0024|適切な歩行者・自転車通行空間が設置されていない|

##### 基準値ファイル
本照査で使用する基準値ファイル(json)の項目は以下の通りである。

|変数名|項目名|アイテム名|
|--|--|--|
|QCR|設計基準交通量|PlannedTv|
|QCR4|設計基準交通量(4車線以上)|Planned4Tv|
|Rate|倍率|PlannedTvRatio|
|Rate4|倍率(4車線以上)|Planned4TvRatio|

## 操作仕様
「チェック実行」ボタンをクリックすると、本照査処理が実行される。

## 照査仕様
本照査の照査対象は**全ての道路規格**である。  
画面入力項目が不足（ブランク）しているとき、照査SKIPと返答する。  

諸条件の設定を使用し照査する。

照査ロジックのワークフローは下記の通りである。
1. 路肩の判定
1. 車線数の判定
1. 中央帯および中央体側帯の判定
1. 植樹帯の判定
1. 停車帯の判定
1. 路肩側帯の判定
1. 歩行者・自転車通行空間の判定

##### 路肩の判定
以下のマトリクスに従って路肩を判定する。

|停車帯または自転車通行帯がある|中央帯を設けない分離道路である|路肩が設置されている|右側路肩が設置されている|判定|メッセージID|
|--|--|--|--|--|--|
|True|True|True|True|NG|W-0015|
|True|True|True|False|NG|W-0014|
|True|True|False|True|OK|I-0009|
|True|True|False|False|NG|W-0013|
|True|False|True|True|NG|W-0017|
|True|False|True|False|NG|W-0018|
|True|False|False|True|NG|W-0016|
|True|False|False|False|OK|I-0010|
|False|True|True|True|OK|I-0007|
|False|True|True|False|NG|W-0009|
|False|True|False|True|NG|W-0008|
|False|True|False|False|NG|W-0007|
|False|False|True|True|NG|W-0012|
|False|False|True|False|OK|I-0008|
|False|False|False|True|NG|W-0011|
|False|False|False|False|NG|W-0010|

###### 停車帯または自転車通行帯がある
幅員構成に照査対象にしている停車帯または自転車通行帯があればTrueとなる。

###### 中央帯を設けない分離道路である
**※本システムは分離道路のJ-LandXMLに対応していないため、正式な判定ではない**  
幅員構成が左側または右側だけで構成されていれば分離道路である。  
または、幅員構成の最初の要素の開始X座標がclOffsetを考慮して0以外であれば、1つの線形で分離されているため分離道路である。

分離道路であり、幅員構成に照査対象にしている中央帯があればTrueとなる。

###### 路肩が設置されている
幅員構成に照査対象にしている路肩があればTrueとなる。

###### 右側路肩が設置されている
幅員構成に照査対象にしている右側路肩があればTrueとなる。

##### 車線数の判定
計画交通量に応じて適切な車線数が設置されているか判定する。  

第3種第5級または第4種第4級道路であるとき、必要車線数は1である。  
それ以外の道路規格の場合は計画交通量に応じた車線数が設置されているか照査する。  

道路規格と道路の地形に応じた`QCR`を取得する。  
また、交差点の多い第4種道路の場合は`QCR`に所定の倍率をかける必要があるため、`Rate`を基準値ファイルから取得する。  
上記に該当しない場合の`Rate`は1である。  

`計画交通量 <= QCR * Rate`であるとき、必要車線数は2である。  
上記判定がFalseであるとき、4車線以上用の`QCR4`を基準値ファイルから取得する。  
同様に、専用の`Rate4`を基準値ファイルから取得する。  
交差点の多い第4種道路でない場合の`Rate4`は1である。

`計画交通量 <= QCR4 * Rate4 * 必要車線数`がTrueとなるまで判定を繰り返す。  
なお、必要車線数は4から始まり2ずつ増加する。
上記判定式がTrueとなったときの必要車線数を照査する。

必要車線数と照査対象の車線の数が一致していれば照査OKとなる。

|判定結果|メッセージID|
|--|--|
|OK|I-0006|
|OK_C|W-0006|

※交差点付近など、車線数が奇数になる場合があるため不一致であっても照査NGとしない

##### 中央帯および中央体側帯の判定
道路規格に応じて中央帯および中央体側帯が設置されているか判定する。  

条件にあったマトリクスに従い照査する。

|第2種道路|第3種第1級道路|4車線以上|中央帯および中央帯側帯があるか|判定|メッセージID|
|--|--|--|--|--|--|
|True|False|True|True|OK|I-0011|
|True|False|True|False|NG|W-0019|
|False|True|True|True|OK|I-0011|
|False|True|True|False|NG|W-0019|

|第1種道路|3車線以下|中央帯および中央帯側帯があるか|判定|メッセージID|
|--|--|--|--|--|
|True|True|True|OK|I-0012|
|True|True|False|OK_C|I-0013|

|中央帯および中央帯側帯があるか|判定|メッセージID|
|--|--|--|
|True|OK_C|I-0015|
|False|OK|I-0014|

##### 植樹帯の判定
下記マトリクスに従い照査する。

|第4種の第1級または第2級道路|植樹帯があるか|判定|メッセージID|
|--|--|--|--|
|True|True|OK|I-0016|
|True|False|OK_C|I-0017|
|False|True|OK_C|I-0019|
|False|False|OK|I-0018|

##### 停車帯の判定
下記マトリクスに従い照査する。

|第4種道路|停車帯があるか|判定|メッセージID|
|--|--|--|--|
|True|True|OK|I-0020|
|True|False|OK_C|I-0021|
|False|True|NG|W-0020|
|False|False|OK|I-0022|

##### 路肩側帯の判定
下記マトリクスに従い照査する。

|第1種または第2種道路|路肩側帯があるか|判定|メッセージID|
|--|--|--|--|
|True|True|OK|I-0091|
|True|False|NG|W-0062|
|False|True|NG|W-0061|
|False|False|OK|I-0090|

##### 歩行者・自転車通行空間の判定
必要空間が設置されているか判定する。  

この判定は**第3種道路または第4種道路**が対象。それ以外の道路は判定せずに照査OKとなる。

|判定|メッセージID|
|--|--|
|OK|I-0023|


自転車ネットワークが計画されている場合は下記マトリクスに従って必要空間を判別する

|設計速度が50km/hを超える|設計速度が40km/h以下|計画交通量が4000台/日以下|必要空間|
|--|--|--|--|
|True|-|-|自転車道+歩道|
|False|True|True|歩道などを設置しない|
|False|False|True|自転車通行帯+歩道|

計画されていない場合は下記フローに従って必要空間を判別する

- 自転車交通量が500台/日以上
  - 計画交通量が4000台/日以上
    - 設計速度が60km/h以上
      - **自転車道+歩道**
    - 設計速度が60km/h未満
      - **自転車通行帯+歩道**
  - 計画交通量が4000台/日未満
    - 設計速度が60km/h以上
      - **自転車道+歩道**
    - 設計速度が60km/h未満
      - 第4種道路
        - **自転車通行帯+歩道**
      - 第4種道路以外
        - 第3種道路であり第5級以外の道路かつ歩行者交通量が500人/日以上
          - **歩道**
        - それ以外
          - **歩道などを設置しない**
- 自転車交通量が500台/日未満
  - 計画交通量が4000台/日以上
    - 歩行者交通量が500人/日以上
      - 設計速度が60km/h以上
        - **自転車道+歩道**
      - 設計速度が60km/h未満
        - **自転車通行帯+歩道**
    - 歩行者交通量が500人/日未満
      - **自転車歩行者道**
  - 計画交通量が4000台/日未満
    - 第4種道路
      - **歩道**
    - 第4種道路以外
      - 第3種道路であり第5級以外の道路かつ歩行者交通量が500人/日以上
        - **歩道**
      - それ以外
        - **歩道などを設置しない**
 
|必要空間が設置されているか|判定|メッセージID|
|--|--|--|
|True|OK|I-0023|
|False|OK_C|I-0024|

※**歩道などを設置しない**のとき、「必要空間が設置されているか」の判定は常にTrueとなる

##### 照査結果を画面に表示
照査結果を画面に表示する。

以上。